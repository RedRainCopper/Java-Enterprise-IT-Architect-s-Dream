# 标准分布式事务
![avatar](./images/XA事务流程图.png)
XA是由X/Open组织提出的分布式事务的规范。XA规范主要定义了（全局）事务管理器（TM）和（局部）资源管理器（RM）之间的接口。主流的关系型数据库产品都实现了XA接口。

XA接口是双向的系统接口，在事务管理器（TM）以及一个或多个资源管理器（RM）之间形成通信桥梁。

XA之所以需要引入事务管理器是因为，在分布式系统中，从理论上讲两台机器无法达成一致的状态，需要引入一个单节点进行协调。

由全局事务管理器，管理和协调的事务，可以跨多个资源（如数据库或者JMS队列）和进程。全局事务管理器一般使用XA进行二阶段提交协议与数据库进行交互。

## 两阶段提交（Two Phase Commit） - 2PC
![avatar](./images/两阶段提交.png)

2PC将事务的提交过程分为：
- 准备阶段
- 提交阶段

事务的发起者（TM集成到业务服务中，称为协调者）称为协调者，事务的执行者（一般指实现了XA协议的数据库等）称为参与者

阶段1：准备阶段
1、协调者向所有参与者发送事务内容，询问是否可以提交事务，并等待所有参与者答复。
2、各参与者执行业务操作，但不提交事务
3、如参与者业务执行成功，给协调者反馈YES，即可以提交；如执行失败，给协调者反馈NO，即不可提交。

阶段2：提交阶段
所有参与者反馈YES，则向所有参与者开始进行事务提交。
任何一个参与者反馈NO时，则终止整个事务内容执行，协调者向所有参与者发出事务回滚指令。

```java
// F:\BaiduYunDownload\架构视频\20191201_分布式事务.mp4  00:34:39

// 引入spring-boot-starter-jta-atomikos包，就支持了分布式事务
```

2PC方案 - 使用简单，但是为什么没人使用呢？
性能太低，性能只有10%（需要确认！！！）


# 柔性事务 - BASE理论
BA: Basic Avalibility 基本业务可用性
S: Sofe state 柔性状态（中间态不一致）
E: Eventual consistency 最终一致性

> 为了更高的性能，高可用，牺牲一致性

> 难点：业界尚未有特别成熟、大规模普及的无侵入性的框架方案

## 三阶段提交协议 - 3PC（对2PC优化）
![avatar](./images/三阶段提交.png)
3PC是对2PC的改进版本。
> 事务的提交过程： CanCommit、PreCommit、doCommit三个阶段来进行处理

-- 00:53:19

阶段1：

阶段2：

阶段3


